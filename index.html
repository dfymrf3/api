<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>âš”ï¸ Fitness RPG</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  /* â”€â”€ RESET & BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg:       #070d18;
    --bg2:      #0d1520;
    --bg3:      #111827;
    --border:   #1e2d45;
    --border2:  #243050;
    --text:     #e8d5a3;
    --muted:    #8899aa;
    --faint:    #445566;
    --gold:     #c9a227;
    --gold2:    #f4d03f;
    --green:    #4caf50;
    --blue:     #81d4fa;
    --orange:   #ff9800;
    --red:      #e53935;
    --purple:   #9c27b0;
    --font-hd:  'Cinzel', serif;
    --font-body:'Crimson Text', Georgia, serif;
  }
  html, body { height: 100%; overflow: hidden; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-body);
    font-size: 15px;
    line-height: 1.5;
  }
  input, button, select { font-family: inherit; }
  button { cursor: pointer; border: none; background: none; }
  ::-webkit-scrollbar { width: 3px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
  input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }

  /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #app {
    max-width: 480px;
    margin: 0 auto;
    height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }
  #topbar {
    flex-shrink: 0;
    padding: 14px 16px 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(180deg, var(--bg) 80%, transparent);
    position: relative;
    z-index: 10;
  }
  #topbar .logo {
    font-family: var(--font-hd);
    font-size: 17px;
    font-weight: 900;
    letter-spacing: 2px;
    color: var(--gold);
  }
  #topbar .user-pill {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--muted);
  }
  #topbar .avatar {
    width: 32px; height: 32px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 17px;
    border: 1px solid;
  }
  #pages {
    flex: 1;
    overflow-y: auto;
    padding: 4px 12px 110px;
    scroll-behavior: smooth;
  }
  #navbar {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    background: linear-gradient(0deg, var(--bg) 70%, transparent);
    padding: 6px 0 14px;
    display: flex;
    justify-content: space-around;
    z-index: 10;
  }
  .nav-btn {
    display: flex; flex-direction: column; align-items: center;
    gap: 3px; padding: 6px 10px;
    color: var(--faint);
    border-radius: 8px;
    transition: color .2s;
    position: relative;
    font-size: 10px;
    min-width: 52px;
  }
  .nav-btn.active { color: var(--gold); }
  .nav-btn.active::before {
    content: '';
    position: absolute;
    top: 0; left: 50%;
    transform: translateX(-50%);
    width: 24px; height: 2px;
    background: var(--gold);
    border-radius: 1px;
    box-shadow: 0 0 6px var(--gold);
  }
  .nav-btn svg { flex-shrink: 0; }

  /* â”€â”€ PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .page { display: none; flex-direction: column; gap: 14px; padding-top: 4px; }
  .page.active { display: flex; }
  .page-title {
    font-family: var(--font-hd);
    font-size: 20px;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 2px;
  }

  /* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .card {
    background: linear-gradient(135deg, var(--bg3) 0%, var(--bg2) 100%);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 2px 8px rgba(0,0,0,.4);
  }
  .card.glow {
    border-color: #c9a22755;
    box-shadow: 0 0 20px rgba(201,162,39,.12);
  }
  .card.glow-red {
    border-color: #e5393555;
    box-shadow: 0 0 20px rgba(229,57,53,.12);
  }

  /* â”€â”€ BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .badge {
    display: inline-block;
    border-radius: 4px;
    padding: 2px 8px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: .5px;
    text-transform: uppercase;
    border: 1px solid;
  }

  /* â”€â”€ XP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .xp-wrap { width: 100%; }
  .xp-labels { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 5px; }
  .xp-track { height: 8px; background: var(--bg2); border-radius: 4px; overflow: hidden; border: 1px solid var(--border2); }
  .xp-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), var(--gold2));
    border-radius: 4px;
    box-shadow: 0 0 8px rgba(201,162,39,.5);
    transition: width 1s ease;
  }

  /* â”€â”€ HP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .hp-track { height: 14px; background: var(--bg2); border-radius: 7px; overflow: hidden; border: 1px solid var(--border2); position: relative; }
  .hp-fill { height: 100%; border-radius: 7px; transition: width 1s ease; }
  .hp-label { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; color: #fff; letter-spacing: 1px; }

  /* â”€â”€ PROGRESS BAR (thin) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .prog-track { height: 5px; background: var(--bg2); border-radius: 3px; overflow: hidden; }
  .prog-fill { height: 100%; border-radius: 3px; transition: width .8s ease; }

  /* â”€â”€ STAT GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
  .stat-box { background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 12px 14px; }
  .stat-label { color: var(--faint); font-size: 11px; letter-spacing: .5px; margin-bottom: 4px; }
  .stat-value { font-family: var(--font-hd); font-size: 20px; font-weight: 800; color: var(--gold); }

  /* â”€â”€ EX BARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .ex-row { margin-bottom: 10px; }
  .ex-row:last-child { margin-bottom: 0; }
  .ex-header { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 3px; }

  /* â”€â”€ LEADERBOARD ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .lb-row {
    display: flex; align-items: center; gap: 12px;
    background: var(--bg2); border: 1px solid var(--border);
    border-radius: 10px; padding: 12px 14px;
    margin-bottom: 8px;
  }
  .lb-row.me { background: linear-gradient(135deg,#c9a22718,#c9a22708); border-color: #c9a22755; }
  .lb-rank { font-size: 20px; width: 28px; text-align: center; flex-shrink: 0; }
  .lb-info { flex: 1; }
  .lb-name { font-weight: 700; font-size: 14px; }
  .lb-sub { font-size: 11px; color: var(--muted); margin-top: 1px; }
  .lb-pts { font-family: var(--font-hd); font-weight: 800; color: var(--gold); white-space: nowrap; }

  /* â”€â”€ QUEST CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .quest-card { padding: 14px 16px; border-radius: 10px; margin-bottom: 8px; border: 1px solid var(--border); background: var(--bg2); }
  .quest-card.done { opacity: .8; }
  .quest-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; margin-bottom: 8px; }
  .quest-title { font-size: 14px; font-weight: 700; }
  .quest-desc { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .quest-right { text-align: right; flex-shrink: 0; }
  .quest-xp { font-size: 12px; font-weight: 700; color: var(--gold); margin-top: 4px; }

  /* â”€â”€ CHAPTER BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chapter-btn {
    display: flex; align-items: center; gap: 12px;
    border-radius: 10px; padding: 14px 16px;
    margin-bottom: 8px; text-align: left;
    border: 1px solid var(--border);
    background: var(--bg2);
    transition: all .2s;
    width: 100%;
  }
  .chapter-btn.active { border-color: #c9a22766; background: linear-gradient(135deg,#c9a22718,#c9a22708); }
  .chapter-btn.done { border-color: #4caf5033; }
  .chapter-btn.locked { opacity: .45; cursor: default; }
  .chapter-emoji { font-size: 22px; flex-shrink: 0; }
  .chapter-info { flex: 1; }
  .chapter-name { font-weight: 700; font-size: 14px; }
  .chapter-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }

  /* â”€â”€ TRAIN EXERCISE GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .ex-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .ex-btn {
    background: var(--bg2); border: 1px solid var(--border);
    border-radius: 8px; padding: 12px 10px;
    color: var(--muted); font-size: 13px; font-weight: 600;
    text-align: left; transition: all .2s;
  }
  .ex-btn.sel { }
  .ex-btn small { display: block; font-size: 11px; opacity: .7; margin-top: 2px; font-weight: 400; }

  /* â”€â”€ TRAIN INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .train-input {
    width: 100%; background: var(--bg2); border: 1px solid var(--border);
    border-radius: 8px; padding: 12px 16px;
    color: var(--text); font-size: 22px; font-weight: 700;
    font-family: var(--font-hd); outline: none;
    transition: border-color .2s;
  }
  .train-input:focus { border-color: var(--gold); }
  .quick-btn {
    background: var(--bg2); border: 1px solid var(--border);
    border-radius: 6px; padding: 6px 12px;
    color: var(--muted); font-size: 12px; transition: all .15s;
  }
  .quick-btn:hover { border-color: var(--gold); color: var(--gold); }

  /* â”€â”€ SUBMIT BTN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .submit-btn {
    width: 100%; padding: 14px;
    border-radius: 8px; font-size: 15px; font-weight: 800;
    color: #000; transition: opacity .2s;
    font-family: var(--font-hd);
    letter-spacing: 1px;
  }
  .submit-btn:hover { opacity: .9; }
  .submit-btn:disabled { opacity: .4; cursor: not-allowed; }

  /* â”€â”€ TAB TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tab-row { display: flex; gap: 8px; }
  .tab-btn {
    flex: 1; padding: 10px 16px; border-radius: 8px;
    font-size: 14px; font-weight: 700;
    border: 1px solid var(--border);
    background: var(--bg2); color: var(--muted);
    transition: all .2s;
  }
  .tab-btn.active {
    background: linear-gradient(135deg,#c9a22718,#c9a22708);
    border-color: #c9a22766; color: var(--gold);
  }

  /* â”€â”€ ACHIEVEMENT GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .ach-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
  .ach-item {
    aspect-ratio: 1; border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; border: 1px solid;
    cursor: pointer; transition: transform .15s;
  }
  .ach-item:hover { transform: scale(1.08); }

  /* â”€â”€ LOADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .loader { text-align: center; padding: 40px; color: var(--muted); }
  .spin { display: inline-block; animation: spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #toast {
    position: fixed; bottom: 90px; left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: linear-gradient(135deg,#1b5e20cc,#1b5e2099);
    border: 1px solid #4caf5066;
    backdrop-filter: blur(10px);
    border-radius: 10px; padding: 12px 20px;
    font-size: 14px; font-weight: 600;
    color: #4caf50; text-align: center;
    max-width: 340px; width: 90%;
    opacity: 0; transition: all .3s;
    z-index: 999; pointer-events: none;
  }
  #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* â”€â”€ LOGIN SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #login-screen {
    position: fixed; inset: 0;
    background: var(--bg);
    display: flex; align-items: center; justify-content: center;
    flex-direction: column; gap: 24px;
    padding: 20px; z-index: 1000;
  }
  #login-screen h1 { font-family: var(--font-hd); font-size: 28px; color: var(--gold); text-align: center; }
  #login-screen p { color: var(--muted); text-align: center; font-size: 14px; max-width: 300px; }
  #uid-input {
    width: 100%; max-width: 320px;
    background: var(--bg2); border: 1px solid var(--border);
    border-radius: 8px; padding: 12px 16px;
    color: var(--text); font-size: 16px; outline: none;
    text-align: center;
  }
  #login-btn {
    width: 100%; max-width: 320px; padding: 14px;
    background: linear-gradient(135deg, var(--gold), var(--gold2));
    border-radius: 8px; font-size: 15px; font-weight: 800;
    color: #000; font-family: var(--font-hd);
  }
  #login-error { color: var(--red); font-size: 13px; min-height: 18px; }

  /* â”€â”€ MISC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .divider { border: none; border-top: 1px solid var(--border); margin: 4px 0; }
  .section-label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
  .success-box {
    background: linear-gradient(135deg,#1b5e2022,#1b5e2011);
    border: 1px solid #4caf5055; border-radius: 12px;
    padding: 16px; text-align: center;
  }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
  .fade-up { animation: fadeUp .35s ease both; }

  /* â”€â”€ WEEK CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .week-chart { display: flex; align-items: flex-end; gap: 5px; height: 70px; }
  .week-bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; }
  .week-bar { width: 100%; border-radius: 3px 3px 0 0; min-height: 3px; transition: height .8s ease; }
  .week-day { font-size: 10px; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div style="font-size:48px">âš”ï¸</div>
  <h1>FITNESS RPG</h1>
  <p>Ğ’Ğ²ĞµĞ´Ğ¸ ÑĞ²Ğ¾Ğ¹ Telegram ID Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚</p>
  <input id="uid-input" type="number" placeholder="Ğ¢Ğ²Ğ¾Ğ¹ Telegram ID" autofocus>
  <div id="login-error"></div>
  <button id="login-btn" onclick="doLogin()">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</button>
  <p style="font-size:12px;color:var(--faint)">Ğ£Ğ·Ğ½Ğ°Ñ‚ÑŒ ID: Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ±Ğ¾Ñ‚Ñƒ /myid</p>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <!-- Topbar -->
  <div id="topbar">
    <div class="logo">âš” FITNESS RPG</div>
    <div class="user-pill">
      <span id="tb-level" style="font-size:12px;color:var(--muted)"></span>
      <div class="avatar" id="tb-avatar"></div>
    </div>
  </div>

  <!-- Pages -->
  <div id="pages">
    <div id="page-home"  class="page active"></div>
    <div id="page-train" class="page"></div>
    <div id="page-quests" class="page"></div>
    <div id="page-league" class="page"></div>
    <div id="page-profile" class="page"></div>
  </div>

  <!-- Navbar -->
  <div id="navbar">
    <button class="nav-btn active" onclick="navigate('home')" id="nb-home">
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
      Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ
    </button>
    <button class="nav-btn" onclick="navigate('train')" id="nb-train">
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"/></svg>
      Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°
    </button>
    <button class="nav-btn" onclick="navigate('quests')" id="nb-quests">
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
      ĞšĞ²ĞµÑÑ‚Ñ‹
    </button>
    <button class="nav-btn" onclick="navigate('league')" id="nb-league">
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8 21h8m-4-4v4m0-4a7 7 0 004.95-11.95L16 5H8l-.95.05A7 7 0 0012 17z"/></svg>
      Ğ›Ğ¸Ğ³Ğ°
    </button>
    <button class="nav-btn" onclick="navigate('profile')" id="nb-profile">
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
      ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
    </button>
  </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG â€” Ğ¿Ğ¾Ğ¼ĞµĞ½ÑĞ¹ BASE_URL Ğ½Ğ° Ğ°Ğ´Ñ€ĞµÑ ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ° Ğ½Ğ° Render.com
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BASE_URL = window.location.origin; // ĞµÑĞ»Ğ¸ index.html Ğ»ĞµĞ¶Ğ¸Ñ‚ Ñ€ÑĞ´Ğ¾Ğ¼ Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼
// const BASE_URL = 'https://your-bot.onrender.com'; // Ğ¸Ğ½Ğ°Ñ‡Ğµ ÑƒĞºĞ°Ğ¶Ğ¸ ÑĞ²Ğ½Ğ¾

// â”€â”€ RACES / CLASSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RACES = {
  human:  { name:'Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞº', emoji:'ğŸ‘¨', color:'#c4a265' },
  orc:    { name:'ĞÑ€Ğº',     emoji:'ğŸ‘¹', color:'#4caf50' },
  elf:    { name:'Ğ­Ğ»ÑŒÑ„',    emoji:'ğŸ§', color:'#81d4fa' },
  dwarf:  { name:'Ğ“Ğ½Ğ¾Ğ¼',    emoji:'ğŸ§”', color:'#ff8a65' },
  undead: { name:'ĞĞµĞ¶Ğ¸Ñ‚ÑŒ',  emoji:'ğŸ’€', color:'#9c27b0' },
  tauren: { name:'Ğ¢Ğ°ÑƒÑ€ĞµĞ½',  emoji:'ğŸ‚', color:'#a1887f' },
};
const CLASSES = {
  warrior: { name:'Ğ’Ğ¾Ğ¸Ğ½',      emoji:'âš”ï¸' },
  mage:    { name:'ĞœĞ°Ğ³',       emoji:'ğŸ”®' },
  rogue:   { name:'Ğ Ğ°Ğ·Ğ±Ğ¾Ğ¹Ğ½Ğ¸Ğº', emoji:'ğŸ—¡ï¸' },
  paladin: { name:'ĞŸĞ°Ğ»Ğ°Ğ´Ğ¸Ğ½',   emoji:'ğŸ›¡ï¸' },
};
const EX_COLORS = {
  'ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ':'#c9a227','ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ':'#4caf50',
  'ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ':'#81d4fa','ĞŸÑ€ĞµÑÑ':'#f44336',
  'Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹':'#ff9800','Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ':'#9c27b0'
};
const EX_EMOJI = {
  'ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ':'ğŸ¦µ','ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ':'ğŸ’ª',
  'ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ':'âœŠ','ĞŸÑ€ĞµÑÑ':'ğŸ”¥','Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹':'ğŸƒ','Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ':'ğŸ“š'
};
const EX_XP = { 'ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ':2,'ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ':5,'ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ':3,'ĞŸÑ€ĞµÑÑ':1,'Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹':6,'Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ':2 };
const DIFF_COLORS = { easy:'#4caf50',medium:'#ff9800',hard:'#f44336',legendary:'#9c27b0' };
const DIFF_LABELS = { easy:'Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹',medium:'Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹',hard:'Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹',legendary:'Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ñ‹Ğ¹' };

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  uid: null,
  user: null,
  todayStats: null,
  weekStats: null,
  quests: null,
  league: null,
  raid: null,
  currentPage: 'home',
  trainEx: 'ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ',
  trainCount: '',
  leagueTab: 'league',
  loading: {},
};

// â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(path, opts = {}) {
  const sep = path.includes('?') ? '&' : '?';
  const url = `${BASE_URL}/api${path}${state.uid ? sep+'user_id='+state.uid : ''}`;
  const res = await fetch(url, opts);
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(err.error || res.statusText);
  }
  return res.json();
}

async function apiPost(path, body) {
  return api(path, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ ...body, user_id: state.uid }),
  });
}

// â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doLogin() {
  const uid = document.getElementById('uid-input').value.trim();
  const errEl = document.getElementById('login-error');
  if (!uid) { errEl.textContent = 'Ğ’Ğ²ĞµĞ´Ğ¸ Telegram ID'; return; }

  const btn = document.getElementById('login-btn');
  btn.textContent = 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...'; btn.disabled = true;
  errEl.textContent = '';

  try {
    state.uid = uid;
    const user = await api('/user');
    state.user = user;

    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² localStorage
    localStorage.setItem('fitness_rpg_uid', uid);

    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'flex';

    await initApp();
  } catch(e) {
    state.uid = null;
    errEl.textContent = e.message.includes('not found') ? 'ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ¹ ĞµĞ³Ğ¾ Ğ² Ğ±Ğ¾Ñ‚Ğµ!' : 'ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message;
    btn.textContent = 'Ğ’Ğ¾Ğ¹Ñ‚Ğ¸'; btn.disabled = false;
  }
}

document.getElementById('uid-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initApp() {
  updateTopbar();

  // Ğ“Ñ€ÑƒĞ·Ğ¸Ğ¼ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾
  const [today, week, quests, league, raid] = await Promise.allSettled([
    api('/stats/today'),
    api('/stats/week'),
    api('/quests'),
    api('/league'),
    api('/raid'),
  ]);

  if (today.status === 'fulfilled')  state.todayStats = today.value;
  if (week.status === 'fulfilled')   state.weekStats  = week.value;
  if (quests.status === 'fulfilled') state.quests     = quests.value;
  if (league.status === 'fulfilled') state.league     = league.value;
  if (raid.status === 'fulfilled')   state.raid       = raid.value;

  renderPage('home');
}

// â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateTopbar() {
  if (!state.user) return;
  const u = state.user;
  const race = RACES[u.race] || { emoji:'âš”ï¸', color:'#c9a227' };
  document.getElementById('tb-level').textContent = 'Ğ£Ñ€. ' + u.level;
  const av = document.getElementById('tb-avatar');
  av.textContent = race.emoji;
  av.style.background = race.color + '33';
  av.style.borderColor = race.color + '66';
}

// â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('nb-' + page).classList.add('active');
  state.currentPage = page;

  // Lazy render
  renderPage(page);

  // Scroll to top
  document.getElementById('pages').scrollTop = 0;
}

// â”€â”€ RENDER DISPATCHER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPage(page) {
  switch(page) {
    case 'home':    renderHome();    break;
    case 'train':   renderTrain();   break;
    case 'quests':  renderQuests();  break;
    case 'league':  renderLeague();  break;
    case 'profile': renderProfile(); break;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHome() {
  const u = state.user;
  if (!u) return;
  const race = RACES[u.race] || { emoji:'âš”ï¸', color:'#c9a227', name:'Ğ“ĞµÑ€Ğ¾Ğ¹' };
  const cls  = CLASSES[u.class] || { emoji:'âš”ï¸', name:'Ğ’Ğ¾Ğ¸Ğ½' };
  const xpPct = Math.min(100, Math.round((u.xp / u.xp_next_level) * 100));
  const today = state.todayStats?.stats || {};
  const todayTotal = state.todayStats?.total || 0;
  const questsDone = state.quests?.quests?.filter(q => q.completed).length || 0;
  const questsTotal = state.quests?.quests?.length || 0;

  const weekDays = state.weekStats?.week || [];
  const maxVal = Math.max(...weekDays.map(d => d.total), 1);

  let html = `
  <!-- HERO CARD -->
  <div class="card glow fade-up" style="position:relative;overflow:hidden">
    <div style="position:absolute;inset:0;background:radial-gradient(ellipse at top right,${race.color}12 0%,transparent 60%);pointer-events:none"></div>
    <div style="display:flex;align-items:center;gap:14px;margin-bottom:14px">
      <div style="width:60px;height:60px;border-radius:12px;background:${race.color}28;border:2px solid ${race.color}55;display:flex;align-items:center;justify-content:center;font-size:30px;flex-shrink:0">${race.emoji}</div>
      <div style="flex:1;min-width:0">
        <div style="font-family:var(--font-hd);font-size:20px;font-weight:800;color:var(--text)">${esc(u.name)}</div>
        <div style="display:flex;gap:6px;margin-top:5px;flex-wrap:wrap">
          <span class="badge" style="color:#81d4fa;border-color:#81d4fa44;background:#81d4fa11">${cls.emoji} ${cls.name}</span>
          <span class="badge" style="color:${race.color};border-color:${race.color}44;background:${race.color}11">${race.emoji} ${race.name}</span>
          ${u.titles?.special?.[0] ? `<span class="badge" style="color:#9c27b0;border-color:#9c27b044;background:#9c27b011">${esc(u.titles.special[0].title||u.titles.special[0])}</span>` : ''}
        </div>
      </div>
    </div>
    <div class="xp-wrap">
      <div class="xp-labels"><span>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ${u.level}</span><span>${u.xp.toLocaleString()} / ${u.xp_next_level.toLocaleString()} XP</span></div>
      <div class="xp-track"><div class="xp-fill" style="width:${xpPct}%"></div></div>
    </div>
  </div>

  <!-- STATS ROW -->
  <div class="stat-grid fade-up">
    <div class="stat-box">
      <div class="stat-label">ğŸ—“ Ğ¡ĞµÑ€Ğ¸Ñ</div>
      <div class="stat-value" style="color:var(--orange)">${u.current_streak}ğŸ”¥</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">ğŸ’ª Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
      <div class="stat-value" style="color:var(--green)">${todayTotal}</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">ğŸ“œ ĞšĞ²ĞµÑÑ‚Ñ‹</div>
      <div class="stat-value" style="color:var(--orange)">${questsDone}/${questsTotal}</div>
    </div>
  </div>

  <!-- WEEK CHART -->
  <div class="card fade-up">
    <div class="section-label">ğŸ“Š ĞĞµĞ´ĞµĞ»Ñ</div>
    <div class="week-chart">
  `;

  weekDays.forEach((d, i) => {
    const h = d.total > 0 ? Math.max(6, Math.round((d.total / maxVal) * 62)) : 0;
    const isToday = i === 6;
    const color = isToday ? 'linear-gradient(180deg,#c9a227,#f4d03f55)' : d.total > 0 ? 'linear-gradient(180deg,#4caf5077,#4caf5022)' : 'var(--border)';
    html += `
      <div class="week-bar-wrap">
        <div style="flex:1;width:100%;display:flex;align-items:flex-end">
          <div class="week-bar" style="background:${color};height:${h}px;border:1px solid ${isToday?'#c9a22755':'transparent'}"></div>
        </div>
        <div class="week-day" style="color:${isToday?'var(--gold)':'var(--faint)'}">${d.day}</div>
      </div>`;
  });

  html += `</div></div>

  <!-- TODAY EXERCISES -->
  <div class="card fade-up">
    <div class="section-label">Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
  `;

  const EXERCISES = ['ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ','ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ','ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ','ĞŸÑ€ĞµÑÑ','Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹','Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ'];
  const EX_MAX = { 'ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ':200,'ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ':50,'ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ':150,'ĞŸÑ€ĞµÑÑ':300,'Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹':100,'Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ':50 };
  EXERCISES.forEach(ex => {
    const val = today[ex] || 0;
    const pct = Math.min(100, Math.round((val / EX_MAX[ex]) * 100));
    const c = EX_COLORS[ex];
    html += `
    <div class="ex-row">
      <div class="ex-header"><span style="color:var(--text)">${EX_EMOJI[ex]} ${ex}</span><span style="color:${c};font-weight:700">${val}</span></div>
      <div class="prog-track"><div class="prog-fill" style="width:${pct}%;background:${c};opacity:.8"></div></div>
    </div>`;
  });

  html += `</div>`;

  // RAID TEASER
  if (state.raid && !state.raid.is_defeated) {
    const r = state.raid;
    const hp = Math.min(100, Math.round((r.current_hp / r.max_hp) * 100));
    html += `
    <div class="card glow-red fade-up">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-size:14px;font-weight:700;color:var(--red)">ğŸ‰ ĞœĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ñ€ĞµĞ¹Ğ´</div>
        <span class="badge" style="color:var(--red);border-color:#e5393544;background:#e5393511">ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½</span>
      </div>
      <div style="font-family:var(--font-hd);font-size:18px;font-weight:800;margin-bottom:8px">${r.boss_emoji} ${esc(r.boss_name)}</div>
      <div class="hp-track"><div class="hp-fill" style="width:${hp}%;background:linear-gradient(90deg,#e53935aa,#e53935)"></div><div class="hp-label">${r.current_hp.toLocaleString()} / ${r.max_hp.toLocaleString()}</div></div>
      <div style="font-size:12px;color:var(--faint);margin-top:6px">Ğ”Ğ¾: ${r.end_date} Â· Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²: ${r.participants.length}</div>
    </div>`;
  }

  document.getElementById('page-home').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRAIN PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTrain() {
  const EXERCISES = ['ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ','ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ','ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ','ĞŸÑ€ĞµÑÑ','Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹','Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ'];
  const ex = state.trainEx;
  const col = EX_COLORS[ex];
  const today = state.todayStats?.stats || {};

  let exBtns = '<div class="ex-grid">';
  EXERCISES.forEach(e => {
    const sel = e === ex;
    const c = EX_COLORS[e];
    exBtns += `<button class="ex-btn${sel?' sel':''}" onclick="selectEx('${e}')"
      style="${sel?`background:${c}22;border-color:${c}66;color:${c}`:''}"
    >${EX_EMOJI[e]} ${e}<small>${EX_XP[e]} XP / Ğ¿Ğ¾Ğ²Ñ‚.</small></button>`;
  });
  exBtns += '</div>';

  const previewXp = (parseInt(state.trainCount) || 0) * EX_XP[ex];

  let quickBtns = '<div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:10px">';
  [5,10,15,20,30,50,100].forEach(n => {
    quickBtns += `<button class="quick-btn" onclick="setCount(${n})">${n}</button>`;
  });
  quickBtns += '</div>';

  let todayRows = '';
  EXERCISES.forEach(e => {
    const val = today[e] || 0;
    if (val > 0) {
      todayRows += `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border)">
        <span>${EX_EMOJI[e]} ${e}</span>
        <span style="color:${EX_COLORS[e]};font-weight:700">${val}</span>
      </div>`;
    }
  });
  const total = state.todayStats?.total || 0;

  document.getElementById('page-train').innerHTML = `
  <div class="page-title">âš”ï¸ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°</div>

  <div class="card fade-up">
    <div class="section-label">Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ</div>
    ${exBtns}
  </div>

  <div class="card fade-up">
    <div class="section-label">${ex === 'Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ' ? 'Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†' : 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹'}</div>
    <div style="display:flex;gap:10px">
      <input class="train-input" id="count-input" type="number" min="1" max="9999"
        value="${state.trainCount}" placeholder="0"
        oninput="state.trainCount=this.value;updateTrainPreview()"
        onkeydown="if(event.key==='Enter')submitTrain()">
      <button onclick="submitTrain()" id="submit-btn"
        style="background:linear-gradient(135deg,${col},${col}aa);border-radius:8px;padding:12px 20px;color:#000;font-size:18px;font-weight:800;flex-shrink:0">+</button>
    </div>
    <div id="xp-preview" style="margin-top:8px;color:var(--gold);font-size:13px;min-height:18px">
      ${previewXp > 0 ? `âœ¨ +${previewXp} XP Ğ·Ğ° ÑÑ‚Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´` : ''}
    </div>
    ${quickBtns}
  </div>

  <div id="train-result"></div>

  ${total > 0 ? `<div class="card fade-up">
    <div class="section-label">Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
    ${todayRows}
    <div style="display:flex;justify-content:space-between;padding:10px 0 0;font-weight:800">
      <span style="color:var(--muted)">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾</span>
      <span style="font-family:var(--font-hd);color:var(--gold)">${total}</span>
    </div>
  </div>` : ''}
  `;
}

function selectEx(ex) {
  state.trainEx = ex;
  renderTrain();
  setTimeout(() => document.getElementById('count-input')?.focus(), 50);
}

function setCount(n) {
  state.trainCount = String(n);
  const inp = document.getElementById('count-input');
  if (inp) { inp.value = n; updateTrainPreview(); }
}

function updateTrainPreview() {
  const n = parseInt(document.getElementById('count-input')?.value) || 0;
  state.trainCount = String(n || '');
  const xp = n * EX_XP[state.trainEx];
  const el = document.getElementById('xp-preview');
  if (el) el.textContent = xp > 0 ? `âœ¨ +${xp} XP Ğ·Ğ° ÑÑ‚Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´` : '';
}

async function submitTrain() {
  const count = parseInt(state.trainCount);
  if (!count || count <= 0) return;

  const btn = document.getElementById('submit-btn');
  if (btn) { btn.disabled = true; btn.textContent = '...'; }

  try {
    const res = await apiPost('/train', { exercise: state.trainEx, count });

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚ĞµĞ¹Ñ‚
    state.user.xp = res.new_xp;
    state.user.xp_next_level = state.user.xp_next_level; // Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ
    state.user.level = res.new_level;
    state.user.current_streak = res.current_streak;

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ stats/today
    if (!state.todayStats) state.todayStats = { stats:{}, total: 0 };
    state.todayStats.stats[state.trainEx] = (state.todayStats.stats[state.trainEx] || 0) + count;
    state.todayStats.total = Object.values(state.todayStats.stats).reduce((a,b)=>a+b,0);

    state.trainCount = '';

    // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    let msg = `${EX_EMOJI[state.trainEx]} ${state.trainEx}: ${count} â†’ <b style="color:var(--gold)">+${res.xp_gained} XP</b>`;
    if (res.level_up) msg += `<br>ğŸ‰ <b style="color:var(--gold2)">Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ${res.new_level}!</b>`;
    if (res.completed_quests?.length) msg += `<br>ğŸ“œ ĞšĞ²ĞµÑÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½: ${res.completed_quests[0]}`;

    document.getElementById('train-result').innerHTML = `
      <div class="success-box fade-up"><div style="font-size:24px">ğŸ‰</div>
      <div style="margin-top:6px;font-size:14px">${msg}</div></div>`;

    updateTopbar();
    showToast(`+${res.xp_gained} XP Ğ·Ğ° ${state.trainEx}`);

    // ĞŸĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ĞºĞ²ĞµÑÑ‚Ñ‹
    api('/quests').then(q => { state.quests = q; }).catch(()=>{});

    setTimeout(() => {
      document.getElementById('train-result').innerHTML = '';
      renderTrain();
    }, 3000);

  } catch(e) {
    showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, '#e53935');
    if (btn) { btn.disabled = false; btn.textContent = '+'; }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTS PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQuests() {
  if (!state.quests) {
    document.getElementById('page-quests').innerHTML = `<div class="loader"><div class="spin">âš™ï¸</div><br>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ²ĞµÑÑ‚Ğ¾Ğ²...</div>`;
    api('/quests').then(q => { state.quests = q; renderQuests(); }).catch(e => {
      document.getElementById('page-quests').innerHTML = `<div class="loader" style="color:var(--red)">ĞÑˆĞ¸Ğ±ĞºĞ°: ${e.message}</div>`;
    });
    return;
  }

  const qs = state.quests.quests || [];
  const done = qs.filter(q => q.completed).length;
  const allDone = state.quests.all_completed;

  let html = `
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div class="page-title">ğŸ“œ ĞšĞ²ĞµÑÑ‚Ñ‹ Ğ´Ğ½Ñ</div>
    <span class="badge" style="color:${allDone?'var(--green)':'var(--orange)'};border-color:${allDone?'#4caf5044':'#ff980044'};background:${allDone?'#4caf5011':'#ff980011'}">${done}/${qs.length}</span>
  </div>
  `;

  if (allDone) {
    html += `<div class="success-box fade-up">
      <div style="font-size:28px">ğŸ‰</div>
      <div style="color:var(--green);font-weight:700;margin-top:6px">Ğ’ÑĞµ ĞºĞ²ĞµÑÑ‚Ñ‹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹!</div>
      <div style="color:var(--gold);font-size:13px">+100 XP Ğ±Ğ¾Ğ½ÑƒÑ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½</div>
    </div>`;
  }

  qs.forEach(q => {
    const pct = Math.min(100, Math.round((q.progress / q.required) * 100));
    const dc = DIFF_COLORS[q.difficulty];
    html += `
    <div class="quest-card${q.completed?' done':''} fade-up">
      <div class="quest-header">
        <div>
          <div class="quest-title">${q.completed?'<span style="color:var(--green)">âœ“</span> ':''}${esc(q.name)}</div>
          <div class="quest-desc">${esc(q.description)}</div>
        </div>
        <div class="quest-right">
          <span class="badge" style="color:${dc};border-color:${dc}44;background:${dc}11">${DIFF_LABELS[q.difficulty]}</span>
          <div class="quest-xp">+${q.xp_reward} XP</div>
        </div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--faint);margin-bottom:3px">
          <span>ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ</span><span>${q.progress}/${q.required}</span>
        </div>
        <div class="prog-track" style="height:6px">
          <div class="prog-fill" style="width:${pct}%;background:${q.completed?'var(--green)':dc}"></div>
        </div>
      </div>
    </div>`;
  });

  document.getElementById('page-quests').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEAGUE PAGE (League + Raid tabs)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLeague() {
  const tab = state.leagueTab;

  let html = `
  <div class="page-title">ğŸ† Ğ¡Ğ¾Ñ€ĞµĞ²Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</div>
  <div class="tab-row">
    <button class="tab-btn${tab==='league'?' active':''}" onclick="setLeagueTab('league')">ğŸ† Ğ›Ğ¸Ğ³Ğ°</button>
    <button class="tab-btn${tab==='raid'?' active':''}" onclick="setLeagueTab('raid')">ğŸ‰ Ğ ĞµĞ¹Ğ´</button>
  </div>`;

  if (tab === 'league') {
    if (!state.league) {
      html += `<div class="loader"><div class="spin">âš™ï¸</div><br>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>`;
      document.getElementById('page-league').innerHTML = html;
      api('/league').then(l => { state.league = l; renderLeague(); }).catch(() => {});
      return;
    }
    const s = state.league.season;
    if (s) {
      html += `<div class="card fade-up">
        <div class="section-label">Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞµĞ·Ğ¾Ğ½</div>
        <div style="font-size:15px;font-weight:700">Ğ¡ĞµĞ·Ğ¾Ğ½ ${s.number || ''} Â· Ğ´Ğ¾ ${s.end_date || '?'}</div>
      </div>`;
    }
    const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    state.league.players?.forEach((p, i) => {
      const race = RACES[p.race] || { emoji:'âš”ï¸' };
      html += `<div class="lb-row${p.is_me?' me':''} fade-up">
        <div class="lb-rank">${medals[i] || (i+1)}</div>
        <div class="lb-info">
          <div class="lb-name" style="color:${p.is_me?'var(--gold)':'var(--text)'}">${esc(p.name)}${p.is_me?' <span style="font-size:11px;color:var(--gold)">(Ñ‚Ñ‹)</span>':''}</div>
          <div class="lb-sub">${race.emoji} Ğ£Ñ€.${p.level}</div>
        </div>
        <div class="lb-pts">${p.points.toLocaleString()}</div>
      </div>`;
    });
  }

  if (tab === 'raid') {
    if (!state.raid) {
      html += `<div class="loader"><div class="spin">âš™ï¸</div><br>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>`;
      document.getElementById('page-league').innerHTML = html;
      api('/raid').then(r => { state.raid = r; renderLeague(); }).catch(() => {});
      return;
    }
    const r = state.raid;
    const hpPct = Math.min(100, Math.round((r.current_hp / r.max_hp) * 100));
    const totalDmg = r.participants.reduce((s,p)=>s+p.damage,0) || 1;
    html += `
    <div class="card glow-red fade-up" style="text-align:center">
      <div style="font-size:48px;margin-bottom:8px">${r.boss_emoji}</div>
      <div style="font-family:var(--font-hd);font-size:20px;font-weight:800;margin-bottom:12px">${esc(r.boss_name)}</div>
      <div class="hp-track"><div class="hp-fill" style="width:${hpPct}%;background:linear-gradient(90deg,#e53935aa,#e53935)"></div>
      <div class="hp-label">${r.current_hp.toLocaleString()} / ${r.max_hp.toLocaleString()}</div></div>
      <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:12px;color:var(--muted)">
        <span>${hpPct}% HP Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ</span><span>Ğ”Ğ¾: ${r.end_date}</span>
      </div>
    </div>
    ${r.my_damage ? `<div class="card fade-up">
      <div class="section-label">Ğ¢Ğ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ½</div>
      <div style="font-family:var(--font-hd);font-size:24px;font-weight:800;color:var(--red)">${r.my_damage.toLocaleString()}</div>
      <div style="font-size:12px;color:var(--faint);margin-top:2px">${Math.round((r.my_damage/totalDmg)*100)}% Ğ¾Ñ‚ Ğ¾Ğ±Ñ‰ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ½Ğ°</div>
    </div>` : ''}
    <div class="section-label" style="margin-top:4px">Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ÑƒÑ€Ğ¾Ğ½Ğ°</div>`;

    const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    r.participants.forEach((p, i) => {
      const pct = Math.round((p.damage / totalDmg) * 100);
      html += `<div style="background:${p.is_me?'linear-gradient(135deg,#e5393522,#e5393511)':'var(--bg2)'};border:1px solid ${p.is_me?'#e5393555':'var(--border)'};border-radius:10px;padding:12px 14px;margin-bottom:8px">
        <div style="display:flex;justify-content:space-between;margin-bottom:5px">
          <span style="font-weight:700;color:${p.is_me?'var(--red)':'var(--text)'}">${medals[i]||''} ${esc(p.name)}</span>
          <span style="color:var(--red);font-weight:800">${p.damage.toLocaleString()}</span>
        </div>
        <div class="prog-track"><div class="prog-fill" style="width:${pct}%;background:var(--red)"></div></div>
      </div>`;
    });
  }

  document.getElementById('page-league').innerHTML = html;
}

function setLeagueTab(tab) {
  state.leagueTab = tab;
  renderLeague();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILE PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderProfile() {
  const u = state.user;
  if (!u) return;
  const race = RACES[u.race] || { emoji:'âš”ï¸', color:'#c9a227', name:'Ğ“ĞµÑ€Ğ¾Ğ¹' };
  const cls  = CLASSES[u.class] || { emoji:'âš”ï¸', name:'Ğ’Ğ¾Ğ¸Ğ½' };
  const xpPct = Math.min(100, Math.round((u.xp / u.xp_next_level) * 100));

  // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
  let achievements = [];
  try {
    const data = await api('/achievements');
    achievements = data.achievements || [];
  } catch(e) {}

  const totals = u.totals || {};
  const EXERCISES = ['ĞŸÑ€Ğ¸ÑĞµĞ´Ğ°Ğ½Ğ¸Ñ','ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ','ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ','ĞŸÑ€ĞµÑÑ','Ğ’Ñ‹Ğ¿Ğ°Ğ´Ñ‹','Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ'];
  const grandTotal = EXERCISES.reduce((s,e) => s+(totals[e]||0), 0);

  const earned = achievements.filter(a => a.earned);
  const notEarned = achievements.filter(a => !a.earned).slice(0, 12);
  const showAch = [...earned, ...notEarned];

  let html = `
  <div class="page-title">ğŸ‘¤ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</div>

  <div class="card glow fade-up" style="text-align:center">
    <div style="width:72px;height:72px;border-radius:14px;margin:0 auto 12px;background:${race.color}33;border:2px solid ${race.color}66;display:flex;align-items:center;justify-content:center;font-size:36px">${race.emoji}</div>
    <div style="font-family:var(--font-hd);font-size:22px;font-weight:800">${esc(u.name)}</div>
    <div style="display:flex;justify-content:center;gap:6px;margin-top:6px;flex-wrap:wrap">
      <span class="badge" style="color:#81d4fa;border-color:#81d4fa44;background:#81d4fa11">${cls.emoji} ${cls.name}</span>
      <span class="badge" style="color:${race.color};border-color:${race.color}44;background:${race.color}11">${race.emoji} ${race.name}</span>
    </div>
    <div style="margin-top:16px">
      <div class="xp-labels"><span>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ${u.level}</span><span>${u.xp.toLocaleString()} / ${u.xp_next_level.toLocaleString()} XP</span></div>
      <div class="xp-track"><div class="xp-fill" style="width:${xpPct}%"></div></div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
    <div class="stat-box">
      <div class="stat-label">ğŸ® Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</div><div class="stat-value">${u.level}</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">ğŸ—“ Ğ¡ĞµÑ€Ğ¸Ñ</div><div class="stat-value" style="color:var(--orange)">${u.current_streak}ğŸ”¥</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">ğŸ† Ğ ĞµĞºĞ¾Ñ€Ğ´ ÑĞµÑ€Ğ¸Ğ¸</div><div class="stat-value" style="color:var(--green)">${u.best_streak}</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">ğŸ“… Ğ”Ğ½ĞµĞ¹ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº</div><div class="stat-value" style="color:var(--blue)">${u.days_trained}</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">ğŸ“œ ĞšĞ²ĞµÑÑ‚Ğ¾Ğ²</div><div class="stat-value" style="color:var(--orange)">${u.quests_completed_total}</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">ğŸ… Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹</div><div class="stat-value" style="color:var(--purple)">${u.achievements.length}</div>
    </div>
  </div>

  <div class="card fade-up">
    <div class="section-label">Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹</div>
    ${EXERCISES.map(ex => {
      const val = totals[ex] || 0;
      return val > 0 ? `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border)">
        <span>${EX_EMOJI[ex]} ${ex}</span>
        <span style="color:${EX_COLORS[ex]};font-weight:700">${val.toLocaleString()}</span>
      </div>` : '';
    }).join('')}
    <div style="display:flex;justify-content:space-between;padding:10px 0 0;font-weight:800">
      <span style="color:var(--muted)">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾</span>
      <span style="font-family:var(--font-hd);color:var(--gold)">${grandTotal.toLocaleString()}</span>
    </div>
  </div>
  `;

  if (showAch.length > 0) {
    html += `<div class="card fade-up">
      <div class="section-label">Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ (${earned.length} / ${achievements.length})</div>
      <div class="ach-grid">`;
    showAch.slice(0, 24).forEach(a => {
      html += `<div class="ach-item"
        style="background:${a.earned?'var(--bg2)':'#090e16'};border-color:${a.earned?'#c9a22733':'var(--border)'};opacity:${a.earned?1:.25}"
        title="${esc(a.name)}: ${esc(a.description)}">${a.icon}</div>`;
    });
    html += `</div></div>`;
  }

  if (u.titles?.special?.length || u.titles?.league?.length || u.titles?.raid?.length) {
    html += `<div class="card fade-up"><div class="section-label">Ğ¢Ğ¸Ñ‚ÑƒĞ»Ñ‹</div><div style="display:flex;flex-wrap:wrap;gap:6px">`;
    [...(u.titles.special||[]), ...(u.titles.league||[]), ...(u.titles.raid||[])].forEach(t => {
      const label = t.title || t;
      html += `<span class="badge" style="color:var(--purple);border-color:#9c27b044;background:#9c27b011">${esc(label)}</span>`;
    });
    html += `</div></div>`;
  }

  html += `<button onclick="logout()" style="width:100%;padding:12px;border-radius:8px;border:1px solid var(--border);background:var(--bg2);color:var(--muted);font-size:14px;margin-top:4px">Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</button>`;

  document.getElementById('page-profile').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer;
function showToast(msg, color = '#4caf50') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.style.color = color;
  el.style.borderColor = color + '55';
  el.style.background = `linear-gradient(135deg,${color}22,${color}11)`;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function esc(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function logout() {
  localStorage.removeItem('fitness_rpg_uid');
  location.reload();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-LOGIN (if uid saved)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function autoLogin() {
  const saved = localStorage.getItem('fitness_rpg_uid');
  if (saved) {
    document.getElementById('uid-input').value = saved;
    // Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° ÑƒÑĞ¿ĞµĞ»Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒÑÑ
    setTimeout(doLogin, 100);
  }
})();
</script>
</body>
</html>
